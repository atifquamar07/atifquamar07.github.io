{{ $item := .item }}
{{ $widget := .page }}
{{ $index := .index }}

{{ $do_link := true }}
{{ if $item.Params.external_link | or $item.Content }}
  {{ $do_link = true }}
{{ else }}
  {{ $do_link = false }}
{{ end }}

{{ $link := $item.Params.external_link | default $item.RelPermalink }}
{{ $target := .target }}

{{/* Get summary. */}}
{{ $summary := "" }}
{{ if $item.Params.summary }}
  {{ $summary = $item.Params.summary | markdownify | emojify }}
{{ else if $item.Params.abstract }}
  {{ $summary = $item.Params.abstract | markdownify | emojify }}
{{ else if $item.Summary }}
  {{ $summary = $item.Summary }}
{{ end }}

{{ $order := "" }}
{{ if and ($widget.Params.design.flip_alt_rows | default true) (not (modBool $index 2)) }}
  {{ $order = "order-md-2" }}
{{ end }}


<div class="col-lg-12 mb-5 view-showcase">
  <div class="row align-items-center">
    <div class="col-12 col-md-6">
      <div class="section-subheading article-title mb-0 mt-0">
        {{- if $do_link}}<a href="{{ $link }}" {{ $target | safeHTMLAttr }}>{{end -}}
        {{ $item.Title | markdownify | emojify }}
        {{- if $do_link}}</a>{{end -}}
      </div>

      {{ with $item.Params.authors }}
<div class="project-authors mb-2">
  {{/* Controls (page-level) */}}
  {{ $primary := $item.Params.primary_author_index | default -1 }}   {{/* zero-based index to bold; -1 = none */}}
  {{ $sups := $item.Params.author_superscripts }}                    {{/* array of superscripts by index ("" for none) */}}

  {{ range $i, $a := . }}
    {{ $isMap := reflect.IsMap $a }}
    {{ $name := cond $isMap ($a.name) $a }}
    {{ $url  := cond $isMap ($a.url)  "" }}

    {{/* Determine bold: author-level .bold overrides, else primary index */}}
    {{ $bold := false }}
    {{ if $isMap }}
      {{ with $a.bold }}{{ $bold = . }}{{ end }}
    {{ end }}
    {{ if and (not $bold) (eq $i $primary) }}{{ $bold = true }}{{ end }}

    {{/* Determine superscript: author-level .sup overrides, else from author_superscripts */}}
    {{ $sup := "" }}
    {{ if $isMap }}{{ with $a.sup }}{{ $sup = printf "%v" . }}{{ end }}{{ end }}
    {{ if and (eq $sup "") $sups (lt $i (len $sups)) }}
      {{ $sup = printf "%v" (index $sups $i) }}
    {{ end }}

    <span class="author-chip">
      {{ if $url }}<a href="{{ $url }}" target="_blank" rel="noopener noreferrer">{{ end }}
      {{ if $bold }}<strong>{{ end }}
      {{ $name }}
      {{ if ne $sup "" }}<sup>{{ $sup }}</sup>{{ end }}
      {{ if $bold }}</strong>{{ end }}
      {{ if $url }}</a>{{ end }}
    </span>{{ if lt $i (sub (len $item.Params.authors) 1) }}, {{ end }}
  {{ end }}
</div>
{{ end }}


      {{ with $summary }}
      <div class="article-style">
        {{ . }}
      </div>
      {{ end }}

      <div class="btn-links">
        {{ partial "page_links" (dict "page" $item "is_list" 0) }}
      </div>

    </div>
    <div class="col-12 col-md-6 order-first {{$order}}">
      {{ $resource := partial "wowchemy-core/functions/get_featured_image.html" $item }}

      {{ with $resource }}
        {{/* Use CSS to expand images to consistent widths rather than just Hugo as Hugo can significantly increase the
        filesize of GIFs when processing them, e.g. 400kB --> 1.5MB */}}
        {{ $image := . }}
        {{ if ne $image.MediaType.SubType "gif" }}{{ $image = $image.Process "resize 540x webp" }}{{ end }}
        {{if $do_link}}<a href="{{ $link }}" {{ $target | safeHTMLAttr }}>{{end}}
          <img src="{{ $image.RelPermalink }}" height="{{ $image.Height }}" width="{{ $image.Width }}"
              alt="{{ $item.Title }}" loading="lazy" style="width: 540px; height: auto; object-fit: cover;">
        {{if $do_link}}</a>{{end}}
      {{end}}
    </div>
  </div>
</div>
